---
title: PCA and UMAP classification of vegetable oils with tidymodels & base R 
author: maria
date: '2021-02-04'
categories:
  - R
tags:
  - r
  - modeldata
  - PCA
  - UMAP
  - tidymodels
slug:  unsupervised machine learning with Tidymodels
subtitle: Comparing the steps followed in Tidymodels and base R to do dimensionality reduction.
summary: Create a recipe, prep it and juice it to do PCA and UMAP with Tidymodels.
lastmod: '2021-02-04'
featured: yes
draft: no
image:
  placement: 1
  caption: 'Fatty acids content in vegetable oils'
  focal_point: Center
  preview_only: no
output:
  blogdown::html_page:
    toc: yes
    number_sections: no
    toc_depth: 1
links:
  - icon: 
    icon_pack: fab
    name: Data from the modeldata pacakge 
    url: https://github.com/tidymodels/modeldata
---

```{r, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

```{r import, results=FALSE,message=FALSE}
library(tidymodels)
library(modeldata)
library(ggfortify)
library(tidyverse)
library(embed)
```

# Motivation and data

While exploring the [modeldata](https://github.com/tidymodels/modeldata) `r emo::ji("package")`, I found the dataset `oils`, which 

## EDA

```{r}
data(oils)
```

```{r}
str(oils)
```

```{r}
oils %>%
  count(class)
```
This looks like fun dataset to project in a reduced dimension space like PCA or UMAP!

# Train and Test Sets
```{r}
set.seed(13)
tidy_split <- initial_split(oils, prop = .8)
tidy_train <- training(tidy_split)
tidy_test <- testing(tidy_split)
k_folds_data <- vfold_cv(tidy_train)
```

# Define Pre-processing
```{r}
pca_rec <- recipe(class~., data = tidy_train) %>% #start writing the recipe with all the data
  update_role(class, new_role = "id") %>% #to keep this column around but not include it in the model
  step_normalize(all_predictors()) %>% #to normalise the data
  step_pca(all_predictors()) #to convert numeric data to principal components

umap_rec <- recipe(class~., data = tidy_train) %>%
  update_role(class, new_role = "id") %>%
  step_normalize(all_predictors()) %>%
   step_umap(all_predictors())


basic_rec <- recipe(class~., data = tidy_train) %>%
  update_role(class, new_role = "id") %>%
  step_normalize(all_predictors())

```

```{r}
pca_regression_model <- linear_reg() %>%
  set_engine("lm") %>%
  set_mode("classification")
umap_model <-linear_reg() %>%
  set_engine("lm") %>%
  set_mode("classification")
randomForest_model <- rand_forest(min_n = tune(), trees = tune()) %>%
   set_engine("randomForest")%>%
  set_mode("classification")
 
```
# Conclusionss
The data processing for doing unsupervised machine learning with Tidymodels are very similar to base R. Linear and non-linear dimensionality reduction algorithms separate the data in the reduced space differently. 
